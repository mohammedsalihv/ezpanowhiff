<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Sign Up - Evara Dashboard</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <link rel="stylesheet" href="/css/adminlogin.css">
    <!-- Add Bootstrap CSS for responsiveness -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assetss/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link href="assetss/css/main.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/user/custom-css/msg-boxes.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <style>
        .text-left {
            text-align: left;
        }
         @media (max-width: 576px) {
            .card-login {
               margin-left: 8%;
                justify-content: center; /* Use !important to ensure the style is applied */
            }
           
        }

        #submit-button{
              background-color: #b31111;
              padding-bottom: 8%;
        }
        

    </style>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <main>
        <div class="text-center mt-2">
            <p class="text-center" style="color: red;">
                {{this.enterUsername}}
                {{this.passwordError}}
                {{this.phoneError}}
                {{this.existingUser}}
            </p>
        </div>
        <section class="content-main mt-80 mb-80">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="card card-login">
                            <div class="card-body">
                                <h4 style="color: black; font-weight:900" class="card-title mb-4">REGISTER</h4>
                                <form action="/userRegister" method="post" id="signup-form">
                                    <div class="mb-3">
                                      
                                        <input style="font-size: small; border: 1px solid rgb(214, 202, 202); padding:10px; height:3vh;" placeholder="Full name" class="form-control" type="text" name="username" id="name" required>
                                    </div>
                                    <div class="mb-3">
                                        
                                        <input style="font-size: small; border: 1px solid rgb(214, 202, 202); padding:10px; height:3vh;" placeholder="Email" class="form-control" type="email" name="email" id="email" required>
                                    </div>
                                    <div class="mb-3">
                                      
                                        <input style="font-size: small; border: 1px solid rgb(214, 202, 202); padding:10px; height:3vh;" placeholder="Phone" class="form-control" type="number" name="phone" id="phone" required>
                                    </div>
                                    <div class="mb-3">
                                       
                                        <input style="font-size: small; border: 1px solid rgb(214, 202, 202); padding:10px; height:3vh;" placeholder="Password" class="form-control" type="password" name="password" id="password" required>
                                    </div>
                                    <div class="mb-3">
                                       
                                        <input style="font-size: small; border: 1px solid rgb(214, 202, 202); padding:10px; height:3vh;" placeholder="Confirm password" class="form-control" type="password" name="passwordRe" id="confirmPassword" required>
                                    </div>
                                    <div class="button-div form-child">
                                        <button  type="submit" class="btn btn-danger w-100 mt-2 mb-4" id="submit-button">Submit</button>
                                    </div>
                                    <div class="text-center">
                                        <a style="text-decoration: none;" href="/login">Already have an account? <span style="color: #b31111; font-weight:700;">login</span></a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script src="assetss/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="assetss/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="assetss/js/vendors/jquery.fullscreen.min.js"></script>
    <script src="/user/custom-js/signup.js" defer></script>
    <!-- Main Script -->
    <script src="assetss/js/main.js" type="text/javascript"></script>



<script>
    const form = document.querySelector('#signup-form')
    const msgPara = document.querySelector('.msg-para');

form.addEventListener('submit', async (event) => {
   try{
    event.preventDefault();
    console.log('form submit');

    const body = getUserDetails();
    const validateResult = verifyUserDetails(body)
    console.log('validateReult : ' + validateResult);
    console.log('body : ' + body );

    if(validateResult.success){
        const result = await shareBody(body);
        console.log('result : ' + result );
        if(result.success){
            window.location.href = '/verify';
        }
    }else {
        console.log('validateResult.message : ' + validateResult.message );
    }
   }
   catch(err){
    console.log('err : ' + err );
   }

    
})


const getUserDetails = () => {
    const username = document.querySelector('#name').value;
    const email = document.querySelector('#email').value;
    const phone = document.querySelector('#phone').value;
    const password = document.querySelector('#password').value;
    const passwordRe = document.querySelector('#confirmPassword').value;

    return body = { username, email, phone , password, passwordRe }
}


const verifyUserDetails = (body) => {
    var { username, email, phone , password, passwordRe } = body;

    if( username === '' || email === '' || phone === '' || password === '' || passwordRe === ''){
        const result = { success: false, message: 'All fields are required.............' }
        return displayError( result );
    }

    if(!isEmailValid(email)){
        const result = { success: false, message: 'Email is not in the correct format' }
        return displayError( result );
    }

    if( password.length < 6 ){
        const result = { success: false, message: 'Password Length cannot be less than 6' }
        return displayError( result );
    }

    if( password !== passwordRe ){
        const result = { success: false, message: 'Password is not matching' }
        return displayError( result );
    }
    
    if(phone.length < 10){
        const result = { success: false, message: 'Phone number should valid' }
        return displayError( result );
    }
    return { success: true };
}



const displayError = (result) => {
    msgPara.parentElement.className = 'msg-box-error';
    msgPara.innerHTML = result.message;
}



const displaySuccess = (result) => {
    console.log('before share body');
    shareBody(body);
    console.log('after sharebody');

    msgPara.innerHTML = result.message;
}


const isEmailValid = (email) => {
    const emailRegex =  /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/g
    return emailRegex.test(email)
}



const shareBody = async (body) => {
    try {
         const response = await fetch('/userRegister', {
             method: 'POST',
             headers: {
                 'Content-Type': 'application/json'
             },
             body: JSON.stringify(body)
         });
         const data = await response.json();
 
         if (data.error) {
            const result = { message: data.error }
            return displayError( result );
         }
        return { success: true };
     }
     catch (err) {
         console.log(err);
         displayError(err);
     }
 }

 
</script>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>





