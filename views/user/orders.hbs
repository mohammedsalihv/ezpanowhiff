<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Page</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800');

    .nav {
      width: 100%;
      background-color: #ffffff;
      display: flex;
      align-items: center;
      position: relative;
      /* Ensure it's on top */
      z-index: 1000;
    }

    .nav>.nav-header {
      flex: 0.95;
      padding-left: 1rem;
    }

    .nav>.nav-header>.nav-title {
      font-size: 22px;
      color: #000000;
      /* Black text */
      font-weight: 900;
    }

    .nav>.nav-list {
      display: flex;
      gap: 2rem;
    }

    .nav>.nav-list>li {
      list-style-type: none;
    }

    .nav>.nav-list>li a {
      text-decoration: none;
      color: #000000;
      /* Black text */
      cursor: pointer;
      font-weight: 900;
    }

    .nav>#nav-check {
      display: none;
    }

    @media (max-width: 768px) {
      .nav>#nav-check {
        display: block;
        /* Show the menu icon */
      }

      .nav>#nav-check:checked+.nav-list {
        display: block;
        /* Display the menu items when checked */
      }

      /* Change the icon color to black */
      .nav>#nav-check+.nav-list .icon {
        color: #000000;
        /* Black icon color */
        font-weight: 900;
      }
    }
  </style>
</head>
<nav class="nav">
  <input type="checkbox" id="nav-check">
  <div class="nav-header">
    <div class="nav-title">
      <button onclick="homePage()" style="background-color: #fff; border:0;"> Home</button>
    </div>
  </div>
  <div class="nav-btn">
    <label for="nav-check">

    </label>
  </div>

  <ul class="nav-list">
    <li><a href="/wishlistPage">
        <i class="fa-regular fa-heart"></i></a></li>
    <li><a href="/cart">
        <i class="fa-solid fa-bag-shopping"></i></a></li>
    <li><a href="/userProductlist">Shop</a></li>
    <li><a href="/userAccount">Account</a></li>
    {{#if this.userLogged}}
    <li><a onclick="logoutConfirmation()">Logout</a></li>
    {{/if}}
  </ul>
</nav>

<body>
  <div style="background-color: #ffffff;" class="page-wrapper">

    <main style="background-color: #ffffff;" class="main">


      <div class="error-content text-center">
        <div class="container p-5 border rounded" style="background-color: #ffffff;">
          <div class="d-flex flex-wrap align-items-center justify-content-between ">
            <div>
              <h4 class="mb-0" style="color: #c96;">order details</h4>
            </div>
            <div>Order status : <span> {{orders.orderStatus}}</span></div>
            <div>Order date : <span> {{orders.OrderedDate}}</span></div>
            <div>Expected status : <span> {{orders.ExpectedArrival}}</span></div>
            <div>OrderId: <span> {{orders.nameRandom}}</span></div>
          </div>
          <div>
            {{#each orderedProducts}}
            <div class="d-flex justify-content-between border border-white p-5 my-3 align-items-center">
              <div><img style="height:80px; width:80px;" src="/images/cropped_{{this.img1}}" alt="product image"></div>
              <div><span>{{this.productName}}</span></div>
              <div><span class="bg badge-info p-1">{{this.statusProduct}}</span></div>
              <div><span>{{this.quantity}}</span></div>
              <div><span><b>â‚¹{{this.salesPrice}}</b></span></div>

              {{#unless ../ordersIndexes}}
              {{#if ../isDelivered}}
              {{#unless (eq this.statusProduct "returned")}}
              {{#unless (eq this.statusProduct "canceled")}}
              <form action="/returnProductOrder" method="POST">
                <input type="hidden" id="order-id" name="orderId" value="{{../orderID}}">
                <input type="hidden" id="product-id" name="productId" value="{{this.productId}}">
                <select style="width: 80%;" id="reason-select" name="returnReason" class="form-select"
                  aria-label="Default select example">
                  <option selected value="Price very high">Price very high</option>
                  <option value="Delivery Time too long">Delivery Time too long</option>
                  <option value="Unsatisfactory Product Information">Unsatisfactory Product Information</option>
                  <option value="Shipping Costs">Shipping Costs</option>
                  <option value="Order Mistakes">Order Mistakes</option>
                  <option value="Change Mind">Change Mind</option>
                  <option value="Other">Other</option>
                </select>
                <button style="margin-left: 25%; width: 80%; color:#fff" id="btn-orderReturn"
                  type="submit">Return</button><br>
              </form>
              {{/unless}}
              {{/unless}}
              {{/if}}
              {{/unless}}
            </div>
            {{/each}}

            <div class="d-flex flex-wrap justify-content-between align-items-end p-2 ">
              <div class="col-4 px-0">
                <div class="">
                  {{orders.address.fullname}}<br>
                  {{orders.address.addressLine}}<br>
                  {{orders.address.City}}<br>
                  {{orders.address.state}}<br>
                  {{orders.address.country}}<br>
                  {{orders.address.pincode}}

                </div>

              </div>
              <div class="col-4 px-0">
                <div class="">

                  {{#if ordersIndexes}}
                  {{#unless isCanceled}}
                  {{#unless isDelivered}}
                  <input type="hidden" id="order-Id" value="{{orders._id}}">
                  <button style="width: 40%; color:#fdfdfd" id="btn-orderReturn" type="button"
                    onclick="cancelOrder()">Cancel order
                  </button>
                  {{/unless}}
                  {{/unless}}
                  {{/if}}
                </div>
              </div>
              <div class="d-flex flex-wrap flex-column align-items-end col-4 px-0">
                <div><span style=" font-size:small">payment method</span> : <span> {{orders.paymentMethod}}</span>
                </div>
                {{#if orders.couponApplied}}
                <div>Discount : <span style="color: green;"> {{orders.couponDetails.discountedAmount}}</span></div>
                {{/if}}
                {{#if orders.deliveryCharge}}
                <div><span style="font-size:small">Delivery charge : </span><span style="color: red;">50.00</span></div>
                {{/if}}
                <div><span style="font-size:small">Subtotal : </span><span>{{orders.totalAmount}}</span>
                </div>


                <div class="mt-3">
                  <div><b style="font-weight: 900; font-size:large; color:#000">Total : </b><span
                      style="font-weight:900; font-size:large; color:#000">{{orders.totalAmount}}</span></div>

                </div>

                <div><button onclick="downloadInvoice(`{{orders._id}}`)" id="btn-invoice" type="button"
                    class="btn btn-primary mt-4 pb-4" data-order-id="<%= order._id %>">Download Invoice</button></div>

              </div>
            </div>

          </div>
        </div>
      </div><!-- End .error-content text-center -->
      <div class="text-center mt-4" style="height: 30vh;">
        {{#if orders.returnRequest}}
        <div style="color: #000; font-weight:300; width:10%;  margin-left:45%;" class="bg bg-warning">Return is
          requested
        </div>
        <button onclick="cancelRequest('{{orders._id}}')" class="bg badge-danger mt-2"
          style="width: 10%; border: 1px; solid #fff; padding: 4px; border-radius:6px;">Cancel
          request</button>
        {{else}}
        {{#if isDelivered}}
        <form>
          <input type="hidden" id="order-id" name="orderId" value="{{orders._id}}">
          <select style="width: 20%; margin-left:40%" id="reason-select" name="returnReason" class="form-select"
            aria-label="Default select example">
            <option value="" disabled selected>Select a reason</option>
            <option value="Price very high">Price very high</option>
            <option value="Delivery Time too long">Delivery Time too long</option>
            <option value="Unsatisfactory Product Information">Unsatisfactory Product Information</option>
            <option value="Shipping Costs">Shipping Costs</option>
            <option value="Order Mistakes">Order Mistakes</option>
            <option value="Change Mind">Change Mind</option>
            <option value="Other">Other</option>
          </select>
          <button style="color: #fff; width:20%;" id="btn-orderReturn" type="button" onclick="confirmReturn()">Return
            order</button><br>
        </form>

        {{else}}
        {{#unless isCanceled}}
        {{#unless ordersIndexes}}
        <input type="hidden" id="order-Id" value="{{orders._id}}">
        <button style="color: #fff; width:20%;" id="btn-orderReturn" type="button" onclick="cancelOrder()">Cancel
          Order</button><br>
        {{/unless}}
        {{/unless}}
        {{/if}}
        {{/if}}
        {{#if orders.acceptRequest}}
        <p style="font-size: medium; color:green">Return request is approved</p>
        {{/if}}
        {{#if orders.rejectRequest}}
        <p style="font-size: medium; color:rgb(228, 3, 3)">Return request is rejected</p>
        {{/if}}
      </div>
    </main><!-- End .main -->


  </div><!-- End .modal-body -->
  </div><!-- End .modal-content -->
  </div><!-- End .modal-dialog -->
  </div><!-- End .modal -->
  <footer class="main">
    <section class="section-padding footer-mid">
      <div class="container pt-15 pb-20">
        <div class="row">
          <div class="col-lg-4 col-md-6">
            <div class="widget-about font-md mb-md-5 mb-lg-0">
              <div class="logo logo-width-1 wow fadeIn animated">
                <a href="/userHome"><img style="width: 100px; height:90px;"
                    src="Logo/5313c5dfeae341de827bdfebb4154726.png" alt="logo"></a>
              </div>
              <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
              <p class="wow fadeIn animated">
                <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
              </p>
              <p class="wow fadeIn animated">
                <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
              </p>
              <p class="wow fadeIn animated">
                <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
              </p>
              <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
              <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                <a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                <a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                <a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                <a href="#"><img src="assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-3">
            <h5 class="widget-title wow fadeIn animated">About</h5>
            <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
              <li><a href="#">About Us</a></li>
              <li><a href="#">Delivery Information</a></li>
              <li><a href="#">Privacy Policy</a></li>
              <li><a href="#">Terms &amp; Conditions</a></li>
              <li><a href="#">Contact Us</a></li>
              <li><a href="#">Support Center</a></li>
            </ul>
          </div>
          <div class="col-lg-2  col-md-3">
            <h5 class="widget-title wow fadeIn animated">My Account</h5>
            <ul class="footer-list wow fadeIn animated">
              <li><a href="/signUp">Sign In</a></li>
              <li><a href="#">View Cart</a></li>
              <li><a href="#">My Wishlist</a></li>
              <li><a href="#">Track My Order</a></li>
              <li><a href="#">Help</a></li>
              <li><a href="#">Order</a></li>
            </ul>
          </div>
          <div class="col-lg-4">
            <h5 class="widget-title wow fadeIn animated">Install App</h5>
            <div class="row">
              <div class="col-md-8 col-lg-12">
                <p class="wow fadeIn animated">From App Store or Google Play</p>
                <div class="download-app wow fadeIn animated">
                  <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active" src="assets/imgs/theme/app-store.jpg"
                      alt=""></a>
                  <a href="#" class="hover-up"><img src="assets/imgs/theme/google-play.jpg" alt=""></a>
                </div>
              </div>
              <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                <img class="wow fadeIn animated" src="assets/imgs/theme/payment-method.png" alt="">
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="container pb-20 wow fadeIn animated">
      <div class="row">
        <div class="col-12 mb-20">
          <div class="footer-bottom"></div>
        </div>
        <div class="col-lg-6">
          <p class="float-md-left font-sm text-muted mb-0">&copy; 2024, <strong class="text-brand">EzpanoWhiff</strong>
            Pvt Ltd </p>
        </div>
        <div class="col-lg-6">
          <p class="text-lg-end text-start font-sm text-muted mb-0">
            Designed by <a href="http://alithemes.com" target="_blank">Mohammed salih v</a>. All rights reserved
          </p>
        </div>
      </div>
    </div>
  </footer>
  <!-- Plugins JS File -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="/user/assets/js/jquery.min.js"></script>
  <script src="/user/assets/js/bootstrap.bundle.min.js"></script>
  <script src="/user/assets/js/jquery.hoverIntent.min.js"></script>
  <script src="/user/assets/js/jquery.waypoints.min.js"></script>
  <script src="/user/assets/js/superfish.min.js"></script>
  <script src="/user/assets/js/owl.carousel.min.js"></script>
  <!-- Main JS File -->
  <script src="/user/assets/js/main.js"></script>


  <!-- Razorpay SDK -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <!-- custom-js -->
  <script src="/user/custom-js/order-details.js"></script>

  <script>

    function homePage() {
      window.location.href = '/userHome'
    }




    function downloadInvoice(orderId) {

      // Construct the URL with the order ID
      var url = '/generateInvoice/' + orderId;

      // Redirect to the generated URL
      window.location.href = url;
    }

  </script>

  <script>
    function logoutConfirmation() {
      Swal.fire({
        title: 'Are you sure?',
        text: "You will be logged out!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, log out!'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire(
            'Logged out!',
            'You have been logged out.',
            'success'
          ).then(() => {
            window.location.href = "/userLogout";
          });
        }
      });
    }
  </script>
  <script>
    async function confirmReturn() {
      // Get the selected option value
      const selectedOption = document.getElementById('reason-select').value;
      const selectOrderId = document.getElementById('order-id').value;

      // Check if any option other than the default is selected
      if (!selectedOption) {
        await Swal.fire({
          title: "Error",
          text: "Please select one reason",
          icon: "error",
          confirmButtonColor: "#3085d6",
          confirmButtonText: "OK"
        });
      } else {
        const confirmation = await Swal.fire({
          title: "Are you sure?",
          text: "You won't be able to revert this!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes, Return it!"
        });

        if (confirmation.isConfirmed) {
          const response = await fetch(`/returnOrderRequest/${selectOrderId}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ returnReason: selectedOption })
          });


          if (!response.ok) {
            await Swal.fire({
              title: "Error",
              text: "Your return request failed.",
              icon: "error"
            });
          } else {
            const result = await response.json();
            if (result.success) {
              await Swal.fire({
                title: "Requested!",
                text: "Your return request was sent successfully.",
                icon: "success"
              });
              window.location.reload();
            } else {
              await Swal.fire({
                title: "Error",
                text: result.error || 'Failed to request',
                icon: "error"
              });
            }
          }
        }
      }
    }

  </script>


  <script>

    async function cancelRequest(orderId) {

      const confirmation = await Swal.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, cancel it!"
      });


      if (confirmation.isConfirmed) {
        const response = await fetch(`/cancelRequest/${orderId}`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        })

        if (!response.ok) {
          await Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'request cancel failed!',
          });
        } else {

          const result = await response.json()
          if (result.success) {
            await Swal.fire({
              title: "Canceled!",
              text: "Your return request canceled successfully.",
              icon: "success"
            });
            window.location.reload();
          } else {
            await Swal.fire({
              title: "Error",
              text: 'Failed to cancel',
              icon: "error"
            });
          }
        }
      }
    }
  </script>

  <script>
    function cancelOrder() {
      // Get the order ID
      const orderId = document.getElementById('order-Id').value;
      Swal.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, Cancel it!"
      }).then((result) => {
        if (result.isConfirmed) {
          fetch('/orderCancel', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ orderId: orderId })
          })
            .then(response => response.json())
            .then(data => {
              if (data.error) {
                Swal.fire({
                  icon: 'error',
                  title: 'Error',
                  text: data.error,
                });
              } else {
                Swal.fire({
                  title: "Canceled!",
                  text: "Your order has been canceled.",
                  icon: "success"
                }).then(() => {
                  // Optionally redirect or update the page
                  window.location.reload();
                });
              }
            })
            .catch(error => {
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Item already delivered.',
              });
              console.error('Error:', error);
            });
        }
      });
    }
  </script>

  <script>
    function productCancel(productId, orderId) {
      Swal.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, Cancel it!"
      }).then(() => {

        window.location.href = `/productStatusCancel/${productId}/${orderId}`;


      })

    }
  </script>


</body>

</html>
